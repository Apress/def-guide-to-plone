<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en">
<head>
<link rel="stylesheet" href="silvercity.css" />
<link rel="stylesheet" href="http://clearwind.ca/css/site.css" />
</head>
<body>
<h2>Source</h2>
<p>
<span class="p_commentline">#&nbsp;$Id:&nbsp;source.py,v&nbsp;1.3&nbsp;2003/12/10&nbsp;01:25:48&nbsp;zopezen&nbsp;Exp&nbsp;$</span><span class="p_default"><br/>
</span><span class="p_commentline">#&nbsp;Copyright:&nbsp;ClearWind&nbsp;Consulting&nbsp;Ltd</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">SilverCity</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">LanguageInfo</span><span class="p_default">&nbsp;<br/>
</span><span class="p_word">from</span><span class="p_default">&nbsp;</span><span class="p_identifier">StringIO</span><span class="p_default">&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">StringIO</span><span class="p_default"><br/>
<br/>
</span><span class="p_commentline">#&nbsp;add&nbsp;in&nbsp;extra&nbsp;extensions</span><span class="p_default"><br/>
</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">add_extension</span><span class="p_operator">(</span><span class="p_string">"python"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"cpy"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">add_extension</span><span class="p_operator">(</span><span class="p_string">"python"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"vpy"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">add_extension</span><span class="p_operator">(</span><span class="p_string">"html"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"pt"</span><span class="p_operator">)</span><span class="p_default"><br/>
</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">add_extension</span><span class="p_operator">(</span><span class="p_string">"html"</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"cpt"</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">create_generator</span><span class="p_operator">(</span><span class="p_identifier">source_file_name</span><span class="p_operator">=</span><span class="p_word">None</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator_name</span><span class="p_operator">=</span><span class="p_word">None</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_tripledouble">"""&nbsp;Make&nbsp;a&nbsp;generator&nbsp;from&nbsp;the&nbsp;given&nbsp;information<br/>
&nbsp;&nbsp;&nbsp;&nbsp;about&nbsp;the&nbsp;object,&nbsp;such&nbsp;as&nbsp;its&nbsp;source&nbsp;and&nbsp;type&nbsp;"""</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator_name</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">find_generator_by_name</span><span class="p_operator">(</span><span class="p_identifier">generator_name</span><span class="p_operator">)()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">else</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">source_file_name</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">try</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">h</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">guess_language_for_file</span><span class="p_operator">(</span><span class="p_identifier">source_file_name</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">h</span><span class="p_operator">.</span><span class="p_identifier">get_default_html_generator</span><span class="p_operator">()()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">except</span><span class="p_default">&nbsp;</span><span class="p_identifier">IOError</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_commentline">#&nbsp;this&nbsp;means&nbsp;silvercity&nbsp;tried&nbsp;to&nbsp;the&nbsp;file&nbsp;and&nbsp;failed</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">raise</span><span class="p_default">&nbsp;</span><span class="p_identifier">ValueError</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"Unknown&nbsp;extension&nbsp;for&nbsp;'%s',&nbsp;cannot&nbsp;create&nbsp;lexer"</span><span class="p_default">&nbsp;</span><span class="p_operator">%</span><span class="p_default">&nbsp;</span><span class="p_identifier">source_file_name</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">else</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">raise</span><span class="p_default">&nbsp;</span><span class="p_identifier">ValueError</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_string">"Unknown&nbsp;file&nbsp;type,&nbsp;cannot&nbsp;create&nbsp;lexer"</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">list_generators</span><span class="p_operator">():</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_tripledouble">"""&nbsp;This&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;generators,&nbsp;a&nbsp;generator<br/>
&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;valid&nbsp;language,&nbsp;so&nbsp;these&nbsp;are&nbsp;things&nbsp;like&nbsp;perl,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;python,&nbsp;xml&nbsp;etc..."""</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">lexers</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">get_generator_names_descriptions</span><span class="p_operator">()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">lexers</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">def</span><span class="p_default">&nbsp;</span><span class="p_defname">generate_html</span><span class="p_operator">(</span><span class="p_identifier">source_file</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator</span><span class="p_operator">=</span><span class="p_word">None</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">source_file_name</span><span class="p_operator">=</span><span class="p_word">None</span><span class="p_operator">):</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_tripledouble">"""&nbsp;From&nbsp;the&nbsp;source&nbsp;make&nbsp;a&nbsp;generator<br/>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;then&nbsp;make&nbsp;the&nbsp;html&nbsp;"""</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_commentline">#&nbsp;SilverCity&nbsp;requires&nbsp;a&nbsp;file&nbsp;like&nbsp;object</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">target_file</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">StringIO</span><span class="p_operator">()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">generator</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">create_generator</span><span class="p_operator">(</span><span class="p_identifier">source_file_name</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">generator</span><span class="p_operator">.</span><span class="p_identifier">generate_html</span><span class="p_operator">(</span><span class="p_identifier">target_file</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">source_file</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_commentline">#&nbsp;return&nbsp;the&nbsp;html&nbsp;back</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">return</span><span class="p_default">&nbsp;</span><span class="p_identifier">target_file</span><span class="p_operator">.</span><span class="p_identifier">getvalue</span><span class="p_operator">(),</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator</span><span class="p_operator">.</span><span class="p_identifier">name</span><span class="p_default"><br/>
<br/>
</span><span class="p_word">if</span><span class="p_default">&nbsp;</span><span class="p_identifier">__name__</span><span class="p_default">&nbsp;</span><span class="p_operator">==</span><span class="p_default">&nbsp;</span><span class="p_string">"__main__"</span><span class="p_operator">:</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">sys</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">file</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">sys</span><span class="p_operator">.</span><span class="p_identifier">argv</span><span class="p_operator">[</span><span class="p_number">1</span><span class="p_operator">]</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">fh</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">open</span><span class="p_operator">(</span><span class="p_identifier">file</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_character">'r'</span><span class="p_operator">).</span><span class="p_identifier">read</span><span class="p_operator">()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_commentline">#print&nbsp;generate_html(file,&nbsp;generator="python")</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_commentline">#print&nbsp;list_generators()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">l</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">LanguageInfo</span><span class="p_operator">.</span><span class="p_identifier">guess_language_for_file</span><span class="p_operator">(</span><span class="p_identifier">file</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">text</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">generate_html</span><span class="p_operator">(</span><span class="p_identifier">fh</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_identifier">generator</span><span class="p_operator">=</span><span class="p_identifier">l</span><span class="p_operator">.</span><span class="p_identifier">language_name</span><span class="p_operator">)</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">template</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">open</span><span class="p_operator">(</span><span class="p_character">'template.html'</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_character">'r'</span><span class="p_operator">).</span><span class="p_identifier">read</span><span class="p_operator">()</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">template</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">template</span><span class="p_default">&nbsp;</span><span class="p_operator">%</span><span class="p_default">&nbsp;</span><span class="p_identifier">text</span><span class="p_operator">[</span><span class="p_number">0</span><span class="p_operator">]</span><span class="p_default"><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">out</span><span class="p_default">&nbsp;</span><span class="p_operator">=</span><span class="p_default">&nbsp;</span><span class="p_identifier">open</span><span class="p_operator">(</span><span class="p_character">'out.html'</span><span class="p_operator">,</span><span class="p_default">&nbsp;</span><span class="p_character">'w'</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="p_identifier">out</span><span class="p_operator">.</span><span class="p_identifier">write</span><span class="p_operator">(</span><span class="p_identifier">template</span><span class="p_operator">)</span><span class="p_default"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
</span>
</p>
</body>
</html>
